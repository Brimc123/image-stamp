<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AutoDate - Time & Date Stamp</title>
  <link rel="stylesheet" href="/static/app.css">
</head>
<body>
  <header class="topbar">
    <div class="container row between center">
      <div class="brand">
        <svg style="width:24px;height:24px;vertical-align:middle;margin-right:6px" viewBox="0 0 24 24">
          <path fill="currentColor" d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/>
        </svg>
        AutoDate
      </div>
      <nav class="row gap" style="align-items:center">
        <!-- Login/Signup (visible when logged out) -->
        <div id="authSection" class="row gap">
          <input id="email" class="input sm" type="email" placeholder="email">
          <input id="password" class="input sm" type="password" placeholder="password">
          <button id="loginBtn" class="btn ghost">Login</button>
          <button id="signupBtn" class="btn">Sign up</button>
        </div>
        
        <!-- Navigation links (visible when logged in) -->
        <div id="navSection" class="row gap" style="display:none">
          <a href="/admin" class="link" style="text-decoration:none;color:var(--text);padding:8px 12px">Admin</a>
          <a href="/billing" class="link" style="text-decoration:none;color:var(--text);padding:8px 12px">Billing</a>
          <a href="https://autodate-retrofit.streamlit.app" target="_blank" class="link" style="text-decoration:none;color:var(--accent);padding:8px 12px;font-weight:600">üè† Retrofit Design</a>
          <button id="logoutBtn" class="btn danger ghost">Logout</button>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="row between center">
        <div class="h3">Timestamp Images</div>
        <div class="credits">Credits: <span id="credits">?</span></div>
      </div>

      <p style="color:var(--muted);margin-top:8px">Randomises time per image if an end time is provided.</p>

      <div id="dropzone" class="dropzone">
        <input id="fileInput" type="file" accept=".jpg,.jpeg,.png,.zip" multiple hidden>
        <div class="dz-inner">
          <div class="dz-icon">‚¨Ü</div>
          <div class="dz-title">Drag & drop images here, or click to choose</div>
          <div class="dz-sub">‚Ä¶or <button id="chooseBtn" class="link" type="button">click to choose</button></div>
          <div class="dz-note">We crop from the <strong>bottom</strong> first to remove any old stamp, then add your new one.</div>
          <div id="fileList" class="dz-files"></div>
        </div>
      </div>

      <div class="grid two">
        <label class="field">
          <span>Target date</span>
          <input id="date" class="input" type="date">
        </label>
        <label class="field">
          <span>Date format</span>
          <select id="dateFormat" class="input">
            <option value="%d %b %Y, %H:%M:%S">26 Mar 2025, 12:07:36</option>
            <option value="%d/%m/%Y %H:%M:%S">26/03/2025 12:07:36</option>
            <option value="%Y-%m-%d %H:%M:%S">2025-03-26 12:07:36</option>
          </select>
        </label>

        <label class="field">
          <span>Start time</span>
          <input id="start" class="input" type="time" step="1">
        </label>
        <label class="field">
          <span>End time (optional)</span>
          <input id="end" class="input" type="time" step="1">
        </label>
      </div>

      <div class="row gap">
        <button id="stampBtn" class="btn primary" type="button">Stamp & Download</button>
        <button id="topupBtn" class="btn ghost" type="button">Top up +5 (demo)</button>
      </div>

      <div id="notice" class="notice">
        1 credit = ¬£<span id="price">20</span>. You'll be invoiced weekly. Non-payment may result in account lock.
      </div>

      <div id="progress" class="progress hidden">
        <div class="spinner"></div>
        <div id="progressMsg">Processing‚Ä¶</div>
      </div>

      <div id="toast" class="toast hidden"></div>
    </section>
  </main>

  <script src="/static/app.js"></script>
  <script>
    // Show/hide nav based on login state
    async function updateNav() {
      try {
        const res = await fetch('/auth/status', {credentials:'include'});
        const isLoggedIn = res.ok;
        document.getElementById('authSection').style.display = isLoggedIn ? 'none' : 'flex';
        document.getElementById('navSection').style.display = isLoggedIn ? 'flex' : 'none';
      } catch(e) {
        document.getElementById('authSection').style.display = 'flex';
        document.getElementById('navSection').style.display = 'none';
      }
    }
    
    // Update nav on page load and after login/logout
    updateNav();
    
    // Override original login/logout to update nav
    const origLogin = loginBtn.onclick;
    loginBtn.onclick = async () => {
      await origLogin();
      updateNav();
    };
    
    const origLogout = logoutBtn.onclick;
    logoutBtn.onclick = async () => {
      await origLogout();
      updateNav();
    };
  </script>
</body>
</html>
